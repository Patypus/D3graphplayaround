<head>
    <title>Stacked Bar</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.9/d3.min.js" charset="utf-8"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js" charset="utf-8"></script>
    <script src="Data.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="gas-styles.css">
</head>
<body>
    <div class="tooltip" style="opacity: 0"></div>
    <div class="container">
        <div id="graph">

        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function () {
            var graph = d3.select("#graph");
            var nameOffset = 85; //pixel width of the planet-name div with padding.

            for (var i = 0; i < data.length; i++) {
                var container = graph.append("div")
                                     .classed("bar-container", true);

                container.append("div")
                         .classed("planet-name", true)
                         .append("span")
                         .text(data[i].Planet);

                var bar = container.append("div").style("display", "inline-block");

                var widthExcludingName = $(container[0]).width() - nameOffset;

                var scale = d3.scale.linear();
                scale.domain([0, 100]) //0 to 100 %
                scale.range([0, widthExcludingName]); //available width for bar to scale by percent

                CreateSingleStackedBar(bar, data[i].Atmosphere, scale);
            }
        });

        function CreateSingleStackedBar(element, atmospheres, scale) {
            var containerWidth = $(element[0]).width();

            console.log(atmospheres);

            element.selectAll("div")
                   .data(atmospheres)
                   .enter()
                   .append("div")
                   .attr("class", function (d) { return GetDataClassName(d.DataClass) })
                   .style("width", function (d) { return scale(d.Percent) + "px"; })
                   .on("mouseover", function (d) { showTooltipForSection(d) })
                   .append("span")
                   .text(function (d) { return d.Percent + "%" });
            //resize with page?
        }

        function showTooltipForSection(data) {
            var tooltipDiv = d3.select(".tooltip");
            //colour tooltip for section
            //tooltipDiv.classed(GetDataClassName(data.DataClass), true);
            //set tooltip text
            tooltipDiv.text(data.Gas + ": " + data.Percent + "%");
            //move tooltip to event location
            tooltipDiv.style("left", (d3.event.pageX) + "px")
                      .style("top", (d3.event.pageY) + "px")
                      .style("opacity", 1);
            //show the tooltip
            tooltipDiv.transition()
                      .duration(200)
                      .style("opacity", 1);
        }

        function addHighlightForSection(data) {

        }

        function GetDataClassName(dataClass) {
            return "bar-segment " + dataClass;
        }
    </script>
</body>